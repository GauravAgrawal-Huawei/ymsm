<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>YdtNode.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">onos-app-yms</a> &gt; <a href="index.source.html" class="el_package">org.onosproject.yms.app.ydt</a> &gt; <span class="el_source">YdtNode.java</span></div><h1>YdtNode.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2016-present Open Networking Laboratory
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.onosproject.yms.app.ydt;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;
import org.onosproject.yangutils.datamodel.YangList;
import org.onosproject.yangutils.datamodel.YangSchemaNode;
import org.onosproject.yangutils.datamodel.YangSchemaNodeContextInfo;
import org.onosproject.yangutils.datamodel.YangSchemaNodeIdentifier;
import org.onosproject.yangutils.datamodel.exceptions.DataModelException;
import org.onosproject.yms.app.ydt.exceptions.YdtExceptions;
import org.onosproject.yms.ydt.YdtContext;
import org.onosproject.yms.ydt.YdtContextOperationType;
import org.onosproject.yms.ydt.YdtExtendedInfoType;
import org.onosproject.yms.ydt.YdtType;

/**
 * Represents implementation of interfaces to build and obtain YANG data tree
 * which is data (sub)instance representation, abstract of protocol.
 */
public abstract class YdtNode&lt;T&gt; implements YdtExtendedContext, Cloneable {

    /**
     * Parent reference.
     */
    private YdtNode parent;

    /**
     * First child reference.
     */
    private YdtNode child;

    /**
     * Next sibling reference.
     */
    private YdtNode nextSibling;

    /**
     * Previous sibling reference.
     */
    private YdtNode previousSibling;

    /**
     * Last child reference.
     */
    private YdtNode lastChild;

    /**
     * Type of node.
     */
    private YdtType ydtType;

    /**
     * Flag to keep the track of context switch, It will help ydt to to keep track whether ydtApp tree also need to
     * be traversed back to parent or not.
     * if set traverse in YDT app tree.
     * else no need.
     */
    private boolean isContextSwitch;

    /**
     * YDT extended information.
     */
    private T ydtExtendedInfo;

    /**
     * YDT extended information type.
     */
    private YdtExtendedInfoType ydtExtendedInfoType;

    /**
     * Ydt map to keep the track of node added in YDT.
     */
<span class="pc" id="L93">    final Map&lt;YangSchemaNodeIdentifier, List&lt;YdtNode&lt;T&gt;&gt;&gt; ydtNodeMap = new HashMap&lt;&gt;();</span>

    /**
     * Reference for data-model schema node.
     */
    private YangSchemaNode yangSchemaNode;

    /**
     * Reference for ydt node operation type.
     */
    private YdtContextOperationType ydtContextOperationType;

    /**
     * Key object for ydtNodeMap.
     */
    private YangSchemaNodeIdentifier nodeIdentifier;

    /**
     * Ydt map to keep the track of application information object with respective type.
     */
<span class="pc" id="L113">    private final Map&lt;AppType, Object&gt; ydtAppInfoMap = new HashMap&lt;&gt;();</span>


    // TODO YANG schema mapping attribute

    private YdtContext clonedNode;

    /**
     * Prevents creation of YANG node object.
     */
<span class="nc" id="L123">    private YdtNode() {</span>
<span class="nc" id="L124">    }</span>

    /**
     * Returns the cloned ydt node.
     *
     * @return clonedNode cloned ydt node
     */
    public YdtContext getClonedNode() {
<span class="fc" id="L132">        return clonedNode;</span>
    }

    /**
     * Sets the cloned node.
     *
     * @param clonedNode cloned ydt node
     */
    public void setClonedNode(YdtContext clonedNode) {
<span class="fc" id="L141">        this.clonedNode = clonedNode;</span>
<span class="fc" id="L142">    }</span>

    @Override
    public String getName() {
<span class="fc" id="L146">        return this.nodeIdentifier.getName();</span>
    }

    @Override
    public String getNamespace() {
<span class="fc" id="L151">        return this.nodeIdentifier.getNameSpace();</span>
    }

    @Override
    public &lt;T&gt; T getYdtContextExtendedInfo() {
<span class="nc" id="L156">        return (T) ydtExtendedInfo;</span>
    }

    @Override
    public YdtExtendedInfoType getYdtExtendedInfoType() {
<span class="nc" id="L161">        return ydtExtendedInfoType;</span>
    }

    @Override
    public YdtType getYdtType() {
<span class="fc" id="L166">        return ydtType;</span>
    }

    @Override
    public YdtNode getParent() {
<span class="fc" id="L171">        return parent;</span>
    }

    @Override
    public YdtNode getFirstChild() {
<span class="fc" id="L176">        return child;</span>
    }

    @Override
    public YdtNode getNextSibling() {
<span class="fc" id="L181">        return nextSibling;</span>
    }

    @Override
    public String getValue() {
<span class="nc" id="L186">        return null;</span>
    }

    @Override
    public Set&lt;String&gt; getValueSet() {
<span class="nc" id="L191">        return null;</span>
    }

    @Override
    public YangSchemaNode getYangSchemaNode() {
<span class="fc" id="L196">        return yangSchemaNode;</span>
    }

    @Override
    public YdtNode getLastChild() {
<span class="fc" id="L201">        return lastChild;</span>
    }

    @Override
    public Object getAppInfo(AppType appType) {
<span class="fc" id="L206">        return ydtAppInfoMap.get(appType);</span>
    }

    @Override
    public void setAppInfo(AppType appType, Object object) {
        // Setting the application info map.
<span class="fc" id="L212">        ydtAppInfoMap.put(appType, object);</span>
<span class="fc" id="L213">    }</span>

    @Override
    public YangSchemaNodeContextInfo getSchemaNodeContextInfo(YangSchemaNodeIdentifier nodeIdentifier) {
        try {
<span class="fc" id="L218">            return getYangSchemaNode().getChildSchema(nodeIdentifier);</span>
<span class="nc" id="L219">        } catch (DataModelException e) {</span>
            // Free resources
<span class="nc" id="L221">            freeRestResources();</span>
<span class="nc" id="L222">            throw new YdtExceptions(e.getMessage());</span>
        }
    }

    /**
     * Add value is not valid for non single instance leaf node.
     *
     * @param value value in a single instance node.
     */
    public void addValue(String value) {
        // Free resources
<span class="nc" id="L233">        freeRestResources();</span>
<span class="nc" id="L234">        String errorInfo = &quot;Value cannot be set in non leaf &quot;</span>
<span class="nc" id="L235">                + this.getYdtNodeIdentifier().getName() + &quot; node.&quot;;</span>
<span class="nc" id="L236">        throw new YdtExceptions(errorInfo);</span>
    }

    /**
     * Creates the list of key element's of multi instance node.
     * this will not be applicable on leaf and leaf-list node.
     */
    public void createKeyNodeList() {
        // Free resources
<span class="nc" id="L245">        freeRestResources();</span>
<span class="nc" id="L246">        String errorInfo = &quot;List of key cannot be created for leaf and leaf-list &quot;</span>
<span class="nc" id="L247">                + this.getYdtNodeIdentifier().getName() + &quot; node.&quot;;</span>
<span class="nc" id="L248">        throw new YdtExceptions(errorInfo);</span>
    }

    /**
     * Add value is not valid for non single instance leaf node.
     * this will be applicable in case of call from SBI so no need to validate the value.
     *
     * @param value value in a single instance node.
     */
    public void addValueWithoutValidation(String value) {
        // Free resources
<span class="nc" id="L259">        freeRestResources();</span>
<span class="nc" id="L260">        String errorInfo = &quot;Value cannot be set in non leaf &quot;</span>
<span class="nc" id="L261">                + this.getYdtNodeIdentifier().getName() + &quot; node.&quot;;</span>
<span class="nc" id="L262">        throw new YdtExceptions(errorInfo);</span>
    }

    /**
     * Add value set is not valid for non multi instance leaf node.
     *
     * @param valueSet value set in a multi instance node
     */
    public void addValueSet(Set valueSet) {
        // Free resources
<span class="nc" id="L272">        freeRestResources();</span>
<span class="nc" id="L273">        String errorInfo = &quot;Value cannot be set in non leaf list &quot;</span>
<span class="nc" id="L274">                + this.getYdtNodeIdentifier().getName() + &quot; node.&quot;;</span>
<span class="nc" id="L275">        throw new YdtExceptions(errorInfo);</span>
    }

    /**
     * Add value set is not valid for non multi instance leaf node.
     *
     * @param valueSet value set in a multi instance node
     */
    public void addValueSetWithoutValidation(Set valueSet) {
        // Free resources
<span class="nc" id="L285">        freeRestResources();</span>
<span class="nc" id="L286">        String errorInfo = &quot;Value cannot be set in non leaf list &quot;</span>
<span class="nc" id="L287">                + this.getYdtNodeIdentifier().getName() + &quot; node.&quot;;</span>
<span class="nc" id="L288">        throw new YdtExceptions(errorInfo);</span>
    }

    /**
     * Default implementation is for multi instance node
     * where duplicate entries are valid .
     */
    void isDuplicateEntriesValid() {
<span class="fc" id="L296">    }</span>

    /**
     * Returns already existing YdtNode in Ydt tree with same nodeIdentifier.
     *
     * @param nodeIdentifier represents a identifier of YANG data tree node.
     * @return context of node.
     */
    public YdtExtendedContext getCollidingChild(YangSchemaNodeIdentifier nodeIdentifier) {

        // Find the key in YDT map for getting the colliding node.
<span class="fc" id="L307">        List&lt;YdtNode&lt;T&gt;&gt; collidingChild = ydtNodeMap.get(nodeIdentifier);</span>

        /**
         * if colliding child exist then process colliding node in respective YDT node type.
         */
<span class="fc bfc" id="L312" title="All 2 branches covered.">        if (collidingChild != null) {</span>
<span class="fc" id="L313">            collidingChild.get(0).isDuplicateEntriesValid();</span>
<span class="fc" id="L314">            return collidingChild.get(0);</span>
        }

<span class="fc" id="L317">        return null;</span>
    }

    /**
     * Creates a specific type of node.
     *
     * @param type           of YDT node
     * @param nodeIdentifier node identifier of the YDT node
     */
<span class="fc" id="L326">    YdtNode(YdtType type, YangSchemaNodeIdentifier nodeIdentifier) {</span>
<span class="fc" id="L327">        setYdtType(type);</span>
<span class="fc" id="L328">        setNodeIdentifier(nodeIdentifier);</span>
<span class="fc" id="L329">    }</span>

    /**
     * Sets the node type.
     *
     * @param ydtType type of YDT attribute
     */
    private void setYdtType(YdtType ydtType) {
<span class="fc" id="L337">        this.ydtType = ydtType;</span>
<span class="fc" id="L338">    }</span>

    /**
     * Sets the parent of node.
     *
     * @param parent node
     */
    public void setParent(YdtNode parent) {
<span class="fc" id="L346">        this.parent = parent;</span>
<span class="fc" id="L347">    }</span>

    /**
     * Sets the first instance of a child node.
     *
     * @param child is only child to be set
     */
    public void setChild(YdtNode child) {
<span class="fc" id="L355">        this.child = child;</span>
<span class="fc" id="L356">    }</span>

    /**
     * Sets the next sibling of node.
     *
     * @param sibling YANG node
     */
    public void setNextSibling(YdtNode sibling) {
<span class="fc" id="L364">        nextSibling = sibling;</span>
<span class="fc" id="L365">    }</span>

    /**
     * Returns the previous sibling of a node.
     *
     * @return previous sibling of a node
     */
    public YdtNode getPreviousSibling() {
<span class="fc" id="L373">        return previousSibling;</span>
    }

    /**
     * Sets the previous sibling.
     *
     * @param previousSibling points to predecessor sibling
     */
    public void setPreviousSibling(YdtNode previousSibling) {
<span class="fc" id="L382">        this.previousSibling = previousSibling;</span>
<span class="fc" id="L383">    }</span>

    /**
     * Sets the data-model node reference for of a given node..
     *
     * @param yangSchemaNode YANG data node.
     */
    public void setYangSchemaNode(YangSchemaNode yangSchemaNode) {
<span class="fc" id="L391">        this.yangSchemaNode = yangSchemaNode;</span>
<span class="fc" id="L392">    }</span>

    /**
     * Sets the last instance of a child node.
     *
     * @param child is last child to be set
     */
    public void setLastChild(YdtNode child) {
<span class="fc" id="L400">        this.lastChild = child;</span>
<span class="fc" id="L401">    }</span>

    /**
     * Get object node identifier.
     *
     * @return node identifier.
     */
    public YangSchemaNodeIdentifier getYdtNodeIdentifier() {
<span class="fc" id="L409">        return this.nodeIdentifier;</span>
    }

    /**
     * Set object node identifier.
     *
     * @param nodeIdentifier node identifier.
     */
    public void setNodeIdentifier(YangSchemaNodeIdentifier nodeIdentifier) {
<span class="fc" id="L418">        this.nodeIdentifier = nodeIdentifier;</span>
<span class="fc" id="L419">    }</span>

    /**
     * Adds a child node, the children sibling list will be sorted based on node
     * type.
     *
     * @param newChild refers to a new child to be added
     * @param isAtomic boolean flag to check whether atomic child to be added or sub-tree
     * @throws YdtExceptions in case of violation of any YDT rule
     */
    public void addChild(YdtContext newChild, boolean isAtomic)
            throws YdtExceptions {

        YdtNode newChildImpl;

<span class="pc bpc" id="L434" title="1 of 2 branches missed.">        if (!(newChild instanceof YdtNode)) {</span>
            // Free resources
<span class="nc" id="L436">            freeRestResources();</span>
<span class="nc" id="L437">            throw new YdtExceptions(&quot;Invalid object.&quot;);</span>
        } else {
<span class="fc" id="L439">            newChildImpl = (YdtNode) newChild;</span>
        }

<span class="fc bfc" id="L442" title="All 2 branches covered.">        if (newChildImpl.getParent() == null) {</span>
<span class="fc" id="L443">            newChildImpl.setParent(this);</span>
<span class="pc bpc" id="L444" title="1 of 2 branches missed.">        } else if (newChildImpl.getParent() != this) {</span>
            // Free resources
<span class="nc" id="L446">            freeRestResources();</span>
<span class="nc" id="L447">            throw new YdtExceptions(&quot;Node is already part of a tree&quot;);</span>
        }

<span class="pc bpc" id="L450" title="1 of 4 branches missed.">        if (newChildImpl.getFirstChild() != null &amp;&amp; isAtomic) {</span>
            // Free resources
<span class="nc" id="L452">            freeRestResources();</span>
<span class="nc" id="L453">            throw new YdtExceptions(&quot;Child to be added is not atomic, it already has a child&quot;);</span>
        }

<span class="pc bpc" id="L456" title="1 of 2 branches missed.">        if (newChildImpl.getNextSibling() != null) {</span>
            // Free resources
<span class="nc" id="L458">            freeRestResources();</span>
<span class="nc" id="L459">            throw new YdtExceptions(&quot;Child to be added is not atomic, it already has a next sibling&quot;);</span>
        }

<span class="pc bpc" id="L462" title="1 of 2 branches missed.">        if (newChildImpl.getPreviousSibling() != null) {</span>
            // Free resources
<span class="nc" id="L464">            freeRestResources();</span>
<span class="nc" id="L465">            throw new YdtExceptions(&quot;Child to be added is not atomic, it already has a previous sibling&quot;);</span>
        }

        // First child to be added.
<span class="fc bfc" id="L469" title="All 2 branches covered.">        if (getFirstChild() == null) {</span>
<span class="fc" id="L470">            setChild(newChildImpl);</span>
            // Update last child.
<span class="fc" id="L472">            setLastChild(newChildImpl);</span>
<span class="fc" id="L473">            return;</span>
        }

        // If the new node needs to be add as last child.
<span class="fc" id="L477">        YdtNode curNode = getLastChild();</span>
<span class="fc" id="L478">        curNode.setNextSibling(newChildImpl);</span>
<span class="fc" id="L479">        newChildImpl.setPreviousSibling(curNode);</span>
<span class="fc" id="L480">        setLastChild(newChildImpl);</span>

<span class="fc" id="L482">    }</span>

    @Override
    public YdtContextOperationType getYdtContextOperationType() {
<span class="fc" id="L486">        return ydtContextOperationType;</span>
    }

    /**
     * Set type of YANG data tree node operation.
     *
     * @param opType type of YANG data tree node operation.
     */
    public void setYdtContextOperationType(YdtContextOperationType opType) {
<span class="fc" id="L495">        this.ydtContextOperationType = opType;</span>
<span class="fc" id="L496">    }</span>

    /**
     * Update YDT map of current context parent node.
     *
     * @param nodeIdentifier object node identifier.
     * @param childNode      ydt node for which map need to be updated.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public void updateYdtMap(YangSchemaNodeIdentifier nodeIdentifier, YdtNode childNode) {
<span class="fc" id="L506">        List&lt;YdtNode&lt;T&gt;&gt; collidingChildList = this.ydtNodeMap.get(nodeIdentifier);</span>
<span class="fc bfc" id="L507" title="All 2 branches covered.">        if (collidingChildList == null) {</span>
<span class="fc" id="L508">            collidingChildList = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L509">            collidingChildList.add(childNode);</span>
        } else {
<span class="fc" id="L511">            collidingChildList.add(childNode);</span>
        }
<span class="fc" id="L513">        this.ydtNodeMap.put(nodeIdentifier, collidingChildList);</span>
<span class="fc" id="L514">    }</span>

    /**
     * Returns the flag for for node if context switch.
     *
     * @return isContextSwitch flag of a node.
     */
    public boolean getContextSwitch() {
<span class="fc" id="L522">        return isContextSwitch;</span>
    }

    /**
     * Sets the flag to keep the track of context switch.
     * If it is set then when YDT get traverToParent then traverse back to parent in YDT application tree.
     */
    public void setContextSwitch() {
<span class="fc" id="L530">        isContextSwitch = true;</span>
<span class="fc" id="L531">    }</span>

    /**
     * Validate all multi Instance inside current context.
     * this is not valid for leaf and leaf-list node.
     */
    public void validateMultiInstanceNode() {

        // Set for checking whether input string is unique or not.
<span class="fc" id="L540">        Set&lt;String&gt; keyStringSet = new HashSet&lt;&gt;();</span>

        // Iterating over values in map and find multi instance node list only.
<span class="fc bfc" id="L543" title="All 2 branches covered.">        for (List&lt;YdtNode&lt;T&gt;&gt; ydtNodeList : this.ydtNodeMap.values()) {</span>

            // Clearing the set.
<span class="fc" id="L546">            keyStringSet.clear();</span>
<span class="fc bfc" id="L547" title="All 2 branches covered.">            if (ydtNodeList.get(0) instanceof YdtMultiInstanceNode) {</span>

                // Storing the number of multiInstance node for number if instance validation.
<span class="fc" id="L550">                int totalInstance = ydtNodeList.size();</span>

<span class="fc" id="L552">                YangList listSchemaNode = (YangList) ydtNodeList.get(0).getYangSchemaNode();</span>
                int minElement;
                int maxElement;
<span class="fc bfc" id="L555" title="All 2 branches covered.">                if (null != listSchemaNode.getMinElements()) {</span>
<span class="fc" id="L556">                    minElement = listSchemaNode.getMinElements().getMinElement();</span>
<span class="pc bpc" id="L557" title="1 of 2 branches missed.">                    if (totalInstance &lt; minElement) {</span>
                        // Free resources
<span class="nc" id="L559">                        freeRestResources();</span>
<span class="nc" id="L560">                        String errorInfo = &quot;Too few instances of &quot; +</span>
<span class="nc" id="L561">                                listSchemaNode.getName() + &quot;. Expected minimum instance &quot; + minElement + &quot;.&quot;;</span>
<span class="nc" id="L562">                        throw new YdtExceptions(errorInfo);</span>
                    }
                }

<span class="fc bfc" id="L566" title="All 2 branches covered.">                if (null != listSchemaNode.getMaxElements()) {</span>
<span class="fc" id="L567">                    maxElement = listSchemaNode.getMaxElements().getMaxElement();</span>
<span class="fc bfc" id="L568" title="All 2 branches covered.">                    if (totalInstance &gt; maxElement) {</span>
                        // Free resources
<span class="fc" id="L570">                        freeRestResources();</span>
<span class="fc" id="L571">                        String errorInfo = &quot;Too many instances of &quot; +</span>
<span class="fc" id="L572">                                listSchemaNode.getName() + &quot;. Expected maximum instance &quot; + maxElement + &quot;.&quot;;</span>
<span class="fc" id="L573">                        throw new YdtExceptions(errorInfo);</span>
                    }
                }

<span class="fc bfc" id="L577" title="All 4 branches covered.">                if ((listSchemaNode.isConfig()) &amp;&amp; (totalInstance &gt; 1)) {</span>
                    // Iterating over values in ydtNodeList of multiInstanceNode and compare the key string.
<span class="fc bfc" id="L579" title="All 2 branches covered.">                    for (YdtNode ydtNode : ydtNodeList) {</span>
<span class="fc bfc" id="L580" title="All 2 branches covered.">                        if (!keyStringSet.add(((YdtMultiInstanceNode) ydtNode).getCompositeKeyString())) {</span>
                            // Free resources
<span class="fc" id="L582">                            freeRestResources();</span>
<span class="fc" id="L583">                            String errorInfo = &quot;Some of the key elements are not unique in &quot; +</span>
<span class="fc" id="L584">                                    ydtNode.getYdtNodeIdentifier().getName() + &quot;.&quot;;</span>
<span class="fc" id="L585">                            throw new YdtExceptions(errorInfo);</span>
                        }
<span class="fc" id="L587">                    }</span>
                }
            }
<span class="fc" id="L590">        }</span>
<span class="fc" id="L591">    }</span>

    /**
     * Walk in whole Ydt Tree and de-reference all the tree node.
     * This will be called only when any exception occurs while processing
     * the node in Ydt tree
     */

    public void freeRestResources() {
        // Traversing to to logical rootNode.

<span class="fc" id="L602">        YdtNode rootNode = this;</span>
<span class="fc bfc" id="L603" title="All 2 branches covered.">        while (null != rootNode.getParent()) {</span>
<span class="fc" id="L604">            rootNode = rootNode.getParent();</span>
        }
<span class="fc" id="L606">        YdtNode currentNode = rootNode;</span>
<span class="fc bfc" id="L607" title="All 2 branches covered.">        while (currentNode != null) {</span>

            // Move down to first child
<span class="fc" id="L610">            YdtNode nextNode = currentNode.getFirstChild();</span>
<span class="fc bfc" id="L611" title="All 2 branches covered.">            if (nextNode != null) {</span>
<span class="fc" id="L612">                currentNode = nextNode;</span>
<span class="fc" id="L613">                continue;</span>
            }

            // No child nodes, so walk tree
<span class="fc bfc" id="L617" title="All 2 branches covered.">            while (currentNode != null) {</span>
                // To keep the track of last sibling.
<span class="fc" id="L619">                YdtNode lastSibling = currentNode;</span>

                // Move to sibling if possible.
<span class="fc" id="L622">                nextNode = currentNode.getNextSibling();</span>

                // free currentNode resources
<span class="fc" id="L625">                free(lastSibling);</span>

<span class="fc" id="L627">                lastSibling.getNamespace();</span>
<span class="fc bfc" id="L628" title="All 2 branches covered.">                if (nextNode != null) {</span>
<span class="fc" id="L629">                    currentNode = nextNode;</span>
<span class="fc" id="L630">                    break;</span>
                }

                // Move up
<span class="fc bfc" id="L634" title="All 2 branches covered.">                if (currentNode == rootNode) {</span>
<span class="fc" id="L635">                    currentNode = null;</span>
                } else {

<span class="fc" id="L638">                    currentNode = currentNode.getParent();</span>
<span class="fc" id="L639">                    lastSibling.setParent(null);</span>
                }
<span class="fc" id="L641">            }</span>
<span class="fc" id="L642">        }</span>

<span class="fc" id="L644">    }</span>

    /**
     * Free the give YDT node by de-referencing it to null.
     *
     * @param node node to be free
     */
    private static void free(YdtNode node) {
<span class="fc bfc" id="L652" title="All 2 branches covered.">        if (null != node.getParent()) {</span>
<span class="fc" id="L653">            YdtNode parent = node.getParent();</span>
<span class="fc" id="L654">            parent.setChild(null);</span>
<span class="fc" id="L655">            parent.setLastChild(null);</span>
<span class="fc bfc" id="L656" title="All 2 branches covered.">            if (node.getNextSibling() != null) {</span>
<span class="fc" id="L657">                parent.setChild(node.getNextSibling());</span>
            }
        }
<span class="fc" id="L660">        YdtNode parentRef = node.getParent();</span>
<span class="fc" id="L661">        node = new YdtSingleInstanceNode(null);</span>
<span class="fc" id="L662">        node.setYdtType(null);</span>
<span class="fc" id="L663">        node.setParent(parentRef);</span>
<span class="fc" id="L664">    }</span>

    /**
     * Clones the current node contents and create a new node.
     *
     * @return cloned node
     * @throws CloneNotSupportedException clone is not supported by the referred node
     */
    public Object clone() throws CloneNotSupportedException {
<span class="fc" id="L673">        YdtNode clonedNode = (YdtNode) super.clone();</span>
<span class="fc" id="L674">        clonedNode.setPreviousSibling(null);</span>
<span class="fc" id="L675">        clonedNode.setNextSibling(null);</span>
<span class="fc" id="L676">        clonedNode.setParent(null);</span>
<span class="fc" id="L677">        clonedNode.setChild(null);</span>
<span class="fc" id="L678">        clonedNode.setLastChild(null);</span>
<span class="fc" id="L679">        return clonedNode;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>